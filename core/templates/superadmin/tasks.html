{% extends "superadmin/base.html" %}

{% load i18n %}

{% block content %}

    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Tasks</h1>
    </div>

    <div class="card elasticsearch">
        <h5 class="card-header">Elasticsearch</h5>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="task" value="elasticsearch_rebuild">
                <p>This task will rebuild the complete search index for this site.</p>
                <div class="controls d-flex align-items-start justify-content-start">
                    <select name="index_name" class="form-select" style="width: auto;margin-right: 1rem">
                        <option value="">All indices</option>
                        <option value="group,user">Groups and users</option>
                    </select>
                    <button type="submit" class="btn btn-primary">Rebuild</button>
                </div>
            </form>
        </div>
    </div>
    <br/>

    <div class="card cron-jobs">
        <h5 class="card-header">Cron</h5>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="task" value="dispatch_cron">
                <p>This task will dispatch a cron task one extra time for only this site.</p>
                <div class="controls d-flex align-items-start justify-content-start">
                    <select name="subtask" class="form-select" style="width: auto;margin-right: 1rem">
                        <option value="">--</option>
                        <option value="core.tasks.cronjobs.depublicate_content">Scheduled archive / delete</option>
                        <option value="core.tasks.cronjobs.make_publication_revisions">Make publication revisions</option>
                        <option value="external_content.tasks.fetch_external_content">Fetch external content</option>
                    </select>
                    <button type="submit" class="btn btn-primary">Execute</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card mt-4">
        <h5 class="card-header">Links</h5>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="task" value="replace_links">
                <p>This task will replace links to a old domain with the current domain.</p>
                <div class="mb-3">
                    <label for="replace_domain" class="form-label">Old domain</label>
                    <input type="text" name="replace_domain" class="form-control" id="replace_domain" aria-describedby="replaceDomainHelp">
                    <div id="replaceDomainHelp" class="form-text">Insert the old domain name to be replaced (format: support.pleio.nl).</div>
                </div>
                <button type="submit" class="btn btn-primary">Execute replace links</button>
            </form>
        </div>
    </div>

{% endblock %}